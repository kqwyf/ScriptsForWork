#!/bin/bash

# Use some editor to open the stderr file outputed by the last (?) job, based on './stderr/{job_id}.txt' generated by 'submit'.

set -euo pipefail

###### Default Arguments ######
editor_exe="/mnt/lustre/sjtu/home/yfw51/Softwares/neovim/nvim.appimage"
n=1
###############################

if ! [ -d stderr ]; then
    echo "ERROR: Directory 'stderr' not found. Make sure you are in the work directory." >&2
    exit 1
fi

if [ $# -gt 0 ]; then
    n=${1}
    int_regexp='^[1-9][0-9]*$'
    if ! [[ ${n} =~ ${int_regexp} ]]; then
        echo "ERROR: '${n}' is not an integer." >&2
        exit 1
    fi
fi

filename=`ls -t stderr | grep "^[1-9][0-9]*\.txt$" | head -n ${n} | tail -n 1`

if [ -z "${filename}" ]; then
    echo "No available stderr file." >&2
    exit 1
fi

${editor_exe} stderr/${filename}

